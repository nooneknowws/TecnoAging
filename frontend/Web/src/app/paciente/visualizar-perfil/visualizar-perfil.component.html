<div class="container my-5">
  <h1 class="text-center mb-4">Perfil do Paciente</h1>
  
  <!-- Foto do Perfil -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Foto do Perfil</h5>
    </div>
    <div class="card-body text-center">
      <app-image-upload
        [currentImageUrl]="currentPhotoUrl"
        [placeholderText]="'Clique para adicionar foto do perfil'"
        (imageSelected)="onImageSelected($event)"
        (imageError)="onImageError($event)">
      </app-image-upload>
      <div *ngIf="uploadError" class="alert alert-danger mt-2">
        {{ uploadError }}
      </div>
      <div *ngIf="uploadSuccess" class="alert alert-success mt-2">
        {{ uploadSuccess }}
      </div>
    </div>
  </div>

  <!-- Dados Pessoais Básicos -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Dados Pessoais</h5>
      <button class="btn btn-sm btn-outline-secondary" (click)="toggleDadosPessoais()">
        <i class="fas" [class.fa-chevron-down]="!showDadosPessoais" [class.fa-chevron-up]="showDadosPessoais"></i>
      </button>
    </div>
    <div class="card-body" [class.collapse]="!showDadosPessoais" [class.show]="showDadosPessoais">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Nome Completo:</label>
          <p class="mb-0">{{ paciente?.nome || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">CPF:</label>
          <p class="mb-0">{{ paciente?.cpf || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">RG:</label>
          <p class="mb-0">{{ paciente?.rg || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Órgão Emissor:</label>
          <p class="mb-0">{{ paciente?.orgaoEmissor || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">UF Emissor:</label>
          <p class="mb-0">{{ paciente?.ufEmissor || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Data de Expedição:</label>
          <p class="mb-0">{{ paciente?.dataExpedicao | date:'dd/MM/yyyy' || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Data de Nascimento:</label>
          <p class="mb-0">{{ paciente?.dataNasc | date:'dd/MM/yyyy' || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Idade:</label>
          <p class="mb-0">{{ paciente?.idade ? paciente?.idade + ' anos' : 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Sexo:</label>
          <p class="mb-0">{{ paciente?.sexo || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Estado Civil:</label>
          <p class="mb-0">{{ paciente?.estadoCivil || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Nacionalidade:</label>
          <p class="mb-0">{{ paciente?.nacionalidade || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Município de Nascimento:</label>
          <p class="mb-0">{{ paciente?.municipioNasc || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">UF de Nascimento:</label>
          <p class="mb-0">{{ paciente?.ufNasc || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Cor/Raça:</label>
          <p class="mb-0">{{ paciente?.corRaca || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Telefone:</label>
          <p class="mb-0">{{ paciente?.telefone || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Escolaridade:</label>
          <p class="mb-0">{{ paciente?.escolaridade || 'Não informado' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Endereço -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Endereço</h5>
      <button class="btn btn-sm btn-outline-secondary" (click)="toggleEndereco()">
        <i class="fas" [class.fa-chevron-down]="!showEndereco" [class.fa-chevron-up]="showEndereco"></i>
      </button>
    </div>
    <div class="card-body" [class.collapse]="!showEndereco" [class.show]="showEndereco">
      <div class="row" *ngIf="paciente?.endereco; else noEndereco">
        <div class="col-md-8 mb-3">
          <label class="fw-bold text-muted">Logradouro:</label>
          <p class="mb-0">{{ paciente?.endereco?.logradouro || 'Não informado' }}</p>
        </div>
        <div class="col-md-4 mb-3">
          <label class="fw-bold text-muted">Número:</label>
          <p class="mb-0">{{ paciente?.endereco?.numero || 'S/N' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Bairro:</label>
          <p class="mb-0">{{ paciente?.endereco?.bairro || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">Município:</label>
          <p class="mb-0">{{ paciente?.endereco?.municipio || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">UF:</label>
          <p class="mb-0">{{ paciente?.endereco?.uf || 'Não informado' }}</p>
        </div>
        <div class="col-md-6 mb-3">
          <label class="fw-bold text-muted">CEP:</label>
          <p class="mb-0">{{ paciente?.endereco?.cep || 'Não informado' }}</p>
        </div>
        <div class="col-12 mb-3">
          <label class="fw-bold text-muted">Endereço Completo:</label>
          <p class="mb-0 text-muted">
            {{ getEnderecoCompleto() }}
          </p>
        </div>
      </div>
      <ng-template #noEndereco>
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Nenhum endereço cadastrado para este paciente?.
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Dados Médicos -->
  <div class="card mb-4">
    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Dados Médicos</h5>
      <button class="btn btn-sm btn-outline-secondary" (click)="toggleDadosMedicos()">
        <i class="fas" [class.fa-chevron-down]="!showDadosMedicos" [class.fa-chevron-up]="showDadosMedicos"></i>
      </button>
    </div>
    <div class="card-body" [class.collapse]="!showDadosMedicos" [class.show]="showDadosMedicos">
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="fw-bold text-muted">Peso:</label>
          <p class="mb-0">{{ paciente?.peso ? paciente?.peso! + ' kg' : 'Não informado' }}</p>
        </div>
        <div class="col-md-4 mb-3">
          <label class="fw-bold text-muted">Altura:</label>
          <p class="mb-0">{{ paciente?.altura ? paciente?.altura! + ' cm' : 'Não informado' }}</p>
        </div>
        <div class="col-md-4 mb-3">
          <label class="fw-bold text-muted">IMC:</label>
          <p class="mb-0">
            <span *ngIf="paciente?.imc; else calculatedIMC">{{ paciente?.imc! | number:'1.2-2' }}</span>
            <ng-template #calculatedIMC>
              <span *ngIf="paciente?.peso && paciente?.altura; else noIMC">
                {{ calculateIMC() | number:'1.2-2' }}
              </span>
              <ng-template #noIMC>Não informado</ng-template>
            </ng-template>
          </p>
        </div>
        <div class="col-md-12 mb-3">
          <label class="fw-bold text-muted">Nível Socioeconômico:</label>
          <p class="mb-0">{{ paciente?.socioeconomico || 'Não informado' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Contatos de Emergência -->
  <div class="card mb-4">
    <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Contatos de Emergência</h5>
      <button class="btn btn-sm btn-outline-secondary" (click)="toggleContatos()">
        <i class="fas" [class.fa-chevron-down]="!showContatos" [class.fa-chevron-up]="showContatos"></i>
      </button>
    </div>
    <div class="card-body" [class.collapse]="!showContatos" [class.show]="showContatos">
      <div *ngIf="paciente?.contatos && paciente?.contatos?.length! > 0; else noContatos">
        <div class="row" *ngFor="let contato of paciente?.contatos; let i = index">
          <div class="col-12">
            <div class="card mb-3 border-start border-danger border-4">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <h6 class="card-title text-danger">Contato {{ i + 1 }}</h6>
                  <span class="badge bg-secondary">{{ contato.parentesco || 'Não informado' }}</span>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label class="fw-bold text-muted">Nome:</label>
                    <p class="mb-1">{{ contato.nome || 'Não informado' }}</p>
                  </div>
                  <div class="col-md-6">
                    <label class="fw-bold text-muted">Telefone:</label>
                    <p class="mb-1">{{ contato.telefone || 'Não informado' }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noContatos>
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Nenhum contato de emergência cadastrado para este paciente?.
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Botões de Ação -->
  <div class="d-flex gap-2 justify-content-center mt-4">
    <button class="btn btn-primary">
      <i class="fas fa-edit me-2"></i>Editar Perfil
    </button>
  </div>
</div>