<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card profile-header-card shadow-lg">
        <div class="card-body">
          <div class="row align-items-center">
            <div
              class="col-lg-2 col-md-3 text-center text-md-start mb-3 mb-md-0"
            >
              <app-image-upload
                [currentImageUrl]="currentPhotoUrl"
                [placeholderText]="'Foto'"
                (imageSelected)="onImageSelected($event)"
                (imageError)="onImageError($event)"
                class="profile-photo-wrapper"
              >
              </app-image-upload>
            </div>

            <div class="col-lg-7 col-md-6">
              <h2 class="mb-1">{{ paciente?.nome || "Nome não informado" }}</h2>
              <p class="mb-0 fs-5">
                <i class="fas fa-calendar-alt me-2"></i> {{ getIdade() }} anos •
                {{ paciente?.sexo || "Não informado" }}
              </p>
              <p class="mb-0 small text-white-50">
                CPF: {{ paciente?.cpf || "Não informado" }}
              </p>
            </div>

            <div class="col-lg-3 col-md-3 text-md-end mt-3 mt-md-0">
              <span class="badge bg-white text-dark fs-6 shadow-sm d-block mb-2">
                ID Paciente: {{ paciente?.id }}
              </span>
              <button class="btn btn-primary" (click)="editarPerfil()">
                <i class="fas fa-edit me-2"></i>Editar Perfil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-12">
      <div
        *ngIf="uploadError"
        class="alert alert-danger mb-2 border-0 shadow-sm"
      >
        <i class="fas fa-exclamation-triangle me-2"></i>{{ uploadError }}
      </div>
      <div
        *ngIf="uploadSuccess"
        class="alert alert-success mb-2 border-0 shadow-sm"
      >
        <i class="fas fa-check-circle me-2"></i>{{ uploadSuccess }}
      </div>
      <div
        *ngIf="contatoError"
        class="alert alert-danger mb-2 border-0 shadow-sm"
      >
        <i class="fas fa-exclamation-triangle me-2"></i>{{ contatoError }}
      </div>
      <div
        *ngIf="contatoSuccess"
        class="alert alert-success mb-2 border-0 shadow-sm"
      >
        <i class="fas fa-check-circle me-2"></i>{{ contatoSuccess }}
      </div>
    </div>
  </div>

  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card stat-card h-100 shadow-sm">
        <div class="card-body text-center">
          <i class="fas fa-phone icon-primary fs-2 mb-3"></i>
          <h6 class="mb-1 text-muted">Telefone</h6>
          <p class="mb-0 fs-5 fw-bold">
            {{ formatTelefone(paciente?.telefone || '') || "Não informado" }}
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card h-100 shadow-sm">
        <div class="card-body text-center">
          <i class="fas fa-birthday-cake icon-primary fs-2 mb-3"></i>
          <h6 class="mb-1 text-muted">Data de Nascimento</h6>
          <p class="mb-0 fs-5 fw-bold">
            {{ formatarData(paciente?.dataNasc) }}
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card h-100 shadow-sm">
        <div class="card-body text-center">
          <i class="fas fa-id-card icon-primary fs-2 mb-3"></i>
          <h6 class="mb-1 text-muted">RG</h6>
          <p class="mb-0 fs-5 fw-bold">{{ paciente?.rg || "Não informado" }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-12">
      <div class="card data-card shadow-sm">
        <div
          class="card-header data-card-header"
          (click)="toggleDadosPessoais()"
          [attr.aria-expanded]="showDadosPessoais"
        >
          <h5 class="mb-0">
            <i class="fas fa-user-circle me-2 icon-primary"></i> Identificação e
            Detalhes
          </h5>
          <i
            class="fas icon-toggle"
            [class.fa-chevron-down]="!showDadosPessoais"
            [class.fa-chevron-up]="showDadosPessoais"
          ></i>
        </div>

        <div class="card-body" *ngIf="showDadosPessoais">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="detail-item">
                <label>Estado Civil</label>
                <div>{{ paciente?.estadoCivil || "Não informado" }}</div>
              </div>
              <div class="detail-item">
                <label>Nacionalidade</label>
                <div>{{ paciente?.nacionalidade || "Não informado" }}</div>
              </div>
              <div class="detail-item">
                <label>Município de Nascimento</label>
                <div>{{ paciente?.municipioNasc || "Não informado" }}</div>
              </div>
              <div class="detail-item">
                <label>UF de Nascimento</label>
                <div>{{ paciente?.ufNasc || "Não informado" }}</div>
              </div>
              <div class="detail-item">
                <label>Cor/Raça</label>
                <div>{{ paciente?.corRaca || "Não informado" }}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-item">
                <label>Escolaridade</label>
                <div>{{ paciente?.escolaridade || "Não informado" }}</div>
              </div>
              <div class="detail-item">
                <label>Nível Socioeconômico</label>
                <div>{{ paciente?.socioeconomico || "Não informado" }}</div>
              </div>
              <div class="detail-item" *ngIf="paciente?.peso">
                <label>Peso</label>
                <div>{{ paciente?.peso }} kg</div>
              </div>
              <div class="detail-item" *ngIf="paciente?.altura">
                <label>Altura</label>
                <div>{{ paciente?.altura }} m</div>
              </div>
              <div class="detail-item" *ngIf="paciente?.imc">
                <label>IMC</label>
                <div>{{ paciente?.imc!.toFixed(2) }}</div>
              </div>
            </div>
          </div>

          <hr class="my-4" />

          <div class="detail-item">
            <label>Endereço Completo</label>
            <div>{{ formatarEndereco() }}</div>
          </div>

          <div class="row g-4 mt-1" *ngIf="paciente?.rg">
            <div class="col-md-4">
              <div class="detail-item">
                <label>Data de Expedição</label>
                <div>{{ formatarData(paciente?.dataExpedicao) }}</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="detail-item">
                <label>Órgão Emissor</label>
                <div>{{ paciente?.orgaoEmissor || "Não informado" }}</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="detail-item">
                <label>UF Emissor</label>
                <div>{{ paciente?.ufEmissor || "Não informado" }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-12">
      <div class="card data-card shadow-sm">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-address-book me-2 icon-primary"></i> Contatos de
              Emergência
            </h5>
            <span class="badge bg-light text-dark shadow-sm">
              {{ paciente?.contatos?.length || 0 }}/1 contato
            </span>
          </div>
        </div>

        <div class="card-body">
          <div *ngIf="hasContato()" class="mb-3">
            <div
              class="contact-item"
              *ngFor="let contato of paciente?.contatos"
            >
              <div class="contact-info">
                <i class="fas fa-user-friends me-3 fs-4 text-muted"></i>
                <div>
                  <div class="fw-bold">{{ contato.nome }}</div>
                  <small>{{ contato.parentesco }}</small>
                </div>
              </div>
              <div class="contact-info">
                <i class="fas fa-phone me-2 text-muted"></i>
                <span>{{ formatTelefone(contato.telefone || '') }}</span>
              </div>
              <span class="badge bg-success-light text-success">
                <i class="fas fa-check me-1"></i> Cadastrado
              </span>
            </div>
            <div class="alert alert-info mt-3 border-0">
              <i class="fas fa-info-circle me-2"></i> Você já possui um contato
              cadastrado.
            </div>
          </div>

          <div *ngIf="!hasContato() && !showContatoForm" class="text-center">
            <button
              class="btn btn-primary btn-lg"
              (click)="toggleContatoForm()"
            >
              <i class="fas fa-plus me-2"></i> Adicionar Contato
            </button>
          </div>

          <div *ngIf="showContatoForm" class="card bg-light border-0">
            <div class="card-body">
              <h6 class="text-dark mb-3">
                <i class="fas fa-user-plus me-2"></i> Novo Contato de Emergência
              </h6>
              <form (ngSubmit)="salvarContato()">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Nome Completo *</label>
                    <input
                      type="text"
                      class="form-control"
                      [(ngModel)]="novoContato.nome"
                      name="nome"
                      placeholder="Digite o nome completo"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Telefone *</label>
                    <input
                      type="tel"
                      class="form-control"
                      [(ngModel)]="novoContato.telefone"
                      name="telefone"
                      placeholder="(00) 00000-0000"
                      mask="(00) 0000-0000||(00) 00000-0000"
                      maxlength="15"
                      required
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label">Parentesco *</label>
                    <select
                      class="form-select"
                      [(ngModel)]="novoContato.parentesco!"
                      name="parentesco"
                      required
                    >
                      <option value="" disabled>Selecione o parentesco</option>
                      <option
                        *ngFor="let parentesco of parentescoOptions"
                        [value]="parentesco"
                      >
                        {{ parentesco }}
                      </option>
                    </select>
                  </div>
                </div>
                <div class="d-flex justify-content-end gap-2 mt-4">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    (click)="cancelarContato()"
                  >
                    <i class="fas fa-times me-1"></i> Cancelar
                  </button>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Salvar Contato
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
